include/have_gcs_replication_plugin.inc
############################################################
# 1. Start servers. Execute some transactions on server1.
RESET MASTER;
include/install_gcs_replication.inc
include/start_gcs_replication.inc
RESET MASTER;
include/install_gcs_replication.inc
include/start_gcs_replication.inc
include/rpl_gcs_wait_for_number_of_nodes.inc
CREATE TABLE t1 (c1 INT NOT NULL PRIMARY KEY) ENGINE=InnoDB;
INSERT INTO t1 VALUES (1);

############################################################
# 2. Force negative certification outcome of the next
#    transaction.
SET @@GLOBAL.DEBUG= @debug_saved;
SET @@GLOBAL.DEBUG= '+d,gcs_force_1_negative_certification';
SET @@GLOBAL.DEBUG= @debug_saved;
SET @@GLOBAL.DEBUG= '+d,gcs_force_1_negative_certification';

############################################################
# 3. First insert must be aborted.
INSERT INTO t1 VALUES (2);
ERROR HY000: Got error %d during COMMIT
INSERT INTO t1 VALUES (3);
include/assert.inc ['There is no value 2 in table t1 on server 1']
include/assert.inc ['There is a value 3 in table t1 on server 1']
include/assert.inc ['There is no value 2 in table t1 on server 2']
include/assert.inc ['There is a value 3 in table t1 on server 2']

############################################################
# 4. Clean debug flag on MTR side.
SET @@GLOBAL.DEBUG= @debug_saved;
SET @@GLOBAL.DEBUG= @debug_saved;

############################################################
# 5. Shutdown.
DROP TABLE t1;
include/stop_gcs_replication.inc
include/uninstall_gcs_replication.inc
include/assert.inc ['Aborted transaction should not have increased GNO to 5 on server 1']
RESET MASTER;
include/stop_gcs_replication.inc
include/uninstall_gcs_replication.inc
include/assert.inc ['Aborted transaction should not have increased GNO to 5 on server 2']
RESET MASTER;
