include/have_gcs_replication_plugin.inc
include/install_gcs_replication.inc
#Test a reset command before start.
RESET MASTER;
include/start_gcs_replication.inc
include/install_gcs_replication.inc
include/start_gcs_replication.inc
#Create a table and insert some data
CREATE TABLE t1 (c1 INT NOT NULL PRIMARY KEY) ENGINE=InnoDB;
INSERT INTO t1 VALUES (1);
INSERT INTO t1 VALUES (2);
INSERT INTO t1 VALUES (3);
#Both nodes must have the same GTID set
include/assert.inc [On node 2, all executed GTID should belong to the cluster]
include/assert.inc [On node 1, all executed GTID should belong to the cluster]
#Stop and reset both nodes
include/stop_gcs_replication.inc
RESET MASTER;
include/stop_gcs_replication.inc
RESET MASTER;
#Restart both nodes
include/start_gcs_replication.inc
include/start_gcs_replication.inc
#Both nodes must have an empty gtid set
include/assert.inc [On node 2, all executed GTID should belong to the cluster]
include/assert.inc [On node 1, all executed GTID should belong to the cluster]
#Insert some data to test that the cluster is still running
INSERT INTO t1 VALUES (4);
INSERT INTO t1 VALUES (5);
include/assert.inc [On all nodes, the table should exist and have 5 elements]
include/assert.inc [On all nodes, the table should exist and have 5 elements]
DROP TABLE t1;
include/stop_gcs_replication.inc
include/uninstall_gcs_replication.inc
include/stop_gcs_replication.inc
include/uninstall_gcs_replication.inc
