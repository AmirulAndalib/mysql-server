# ==== Purpose ====
#
# Test that an implicit commit in the middle of a transaction works
# when GTID_NEXT=ANONYMOUS.
#
# ==== Implementation ====
#
# Set gtid_next, start a transaction, execute an implicit commit.
#
# ==== References ====
#
# WL#7592: GTIDs: generate Gtid_log_event and Previous_gtids_log_event always
# BUG#20341210: WL7592: ASSERT AT BINLOG.CC:1139 FOR IMPLICIT COMMIT WHEN GTID_NEXT=ANONYMOUS
# - The test verifies the bug which was found as part of the WL.

--source include/not_gtid_enabled.inc
# No need to run in more than one binlog format.
--source include/have_binlog_format_statement.inc

SET GTID_NEXT = 'ANONYMOUS';
CREATE TABLE t1 (a INT);
BEGIN;
INSERT INTO t1 VALUES (1);
CREATE TABLE t2 (a INT);
INSERT INTO t2 VALUES (1);
COMMIT;

DROP TABLE t1, t2;
