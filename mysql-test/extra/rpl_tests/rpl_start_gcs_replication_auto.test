# WL#7660 - GCS PLUGIN IMPLEMENTATION
#
# This test checks the basic functionality of the GCS replication
# plugin which should work with the .opt file in which the GCS
# replication options are passed as options.
# Synchronous replication will work only for RBR mode of replication so this
# test is restricted to this mode only.

--source include/force_restart.inc
--source include/have_binlog_format_row.inc
--source include/not_embedded.inc
--source include/have_innodb.inc
--source include/have_gtid.inc

SELECT @@gcs_replication_plugin_group_name;
SELECT @@gcs_replication_plugin_start_on_boot;

--error ER_GCS_REPLICATION_RUNNING
START GCS_REPLICATION;

# Even after the server restart the command for starting the GCS_REPLICATION
# should not fail.

--source include/restart_mysqld.inc

--error ER_GCS_REPLICATION_RUNNING
START GCS_REPLICATION;

#Check if the node information is correct on the table

--let $server_uuid= `SELECT @@GLOBAL.SERVER_UUID`

--let $wait_condition= SELECT count(*)=1 FROM performance_schema.replication_connection_nodes WHERE node_id= '$server_uuid' ;
--source include/wait_condition.inc

if (!$success)
{
  --die Timeout in wait_condition.inc
}

STOP GCS_REPLICATION;
