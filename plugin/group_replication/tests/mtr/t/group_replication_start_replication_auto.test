# WL#7660 - GCS PLUGIN IMPLEMENTATION
#
# This test checks the basic functionality of Group Replication
# plugin which should work with the .opt file in which the plugin
# options are passed as options.

--source include/have_group_replication_plugin.inc
--source include/force_restart.inc

SELECT @@group_replication_group_name;
SELECT @@group_replication_start_on_boot;

--error ER_GROUP_REPLICATION_RUNNING
START GROUP_REPLICATION;

# Even after the server restart the command for starting the GROUP_REPLICATION
# should not fail.

--source include/restart_mysqld.inc

--error ER_GROUP_REPLICATION_RUNNING
START GROUP_REPLICATION;

#Check if the member information is correct on the table

--let $server_uuid= `SELECT @@GLOBAL.SERVER_UUID`

--let $wait_condition= SELECT count(*)=1 FROM performance_schema.replication_group_members WHERE member_id= '$server_uuid' ;
--source include/wait_condition.inc

if (!$success)
{
  --die Timeout in wait_condition.inc
}

STOP GROUP_REPLICATION;
