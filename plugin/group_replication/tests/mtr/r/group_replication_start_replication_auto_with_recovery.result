#
# On server 1 stop group replication that started at boot
#
include/stop_group_replication.inc
#
# On server 2 before start, the recovery pass should be empty
#
include/assert.inc [The value of the recovery user name should be recovery_user]
include/assert.inc [The value of the recovery password should be empty]
#
# On server 2 start group replication and create a replication user
#
CREATE USER "recovery_user" IDENTIFIED BY "recovery_password";
GRANT REPLICATION SLAVE ON *.* TO "recovery_user";
FLUSH PRIVILEGES;
include/start_group_replication.inc
CREATE TABLE t1 (c1 INT NOT NULL PRIMARY KEY) ENGINE=InnoDB;
INSERT INTO t1 VALUES (1);
#
# On server 1 start group replication using the recovery user
#
SET GLOBAL group_replication_recovery_user= recovery_user;
SET GLOBAL group_replication_recovery_password= recovery_password;
include/start_group_replication.inc
include/assert.inc [The value of the recovery user name should be recovery_user]
include/assert.inc [The value of the recovery password should be empty]
#
# On server 1 restart the server. Group replication should start at boot
#
# restart
include/rpl_group_replication_wait_for_member_state.inc
#
# On server 1 after restart, the recovery pass should be empty
#
include/assert.inc [The value of the recovery user name should be recovery_user]
include/assert.inc [The value of the recovery password should be empty]
INSERT INTO t1 VALUES (2);
#
# Cleanup
#
DROP USER "recovery_user";
DROP TABLE t1;
include/stop_group_replication.inc
RESET SLAVE ALL FOR CHANNEL "group_replication_applier";
RESET MASTER;
include/stop_group_replication.inc
RESET SLAVE ALL FOR CHANNEL "group_replication_applier";
RESET MASTER;
